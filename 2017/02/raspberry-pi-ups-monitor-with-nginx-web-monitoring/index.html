<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Raspberry Pi UPS monitor (with Nginx web monitoring) | Logan Marchione</title>
<meta name="keywords" content="">
<meta name="description" content="Introduction With the winter weather, we&rsquo;ve been having brownouts and power losses more frequently. I wanted to purchase a UPS to protect my equipment from this, but I also wanted to receive alerts when the power goes out, and possibly shutdown equipment. For this, I need an Uninterruptible Power Supply (UPS) and a computer to monitor it with.
Hardware As you guessed by now, I&rsquo;m going to be using my Raspberry Pi to monitor the UPS.">
<meta name="author" content="Logan Marchione">
<link rel="canonical" href="https://loganmarchione.github.io/2017/02/raspberry-pi-ups-monitor-with-nginx-web-monitoring/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.92af714ca533aa152c7e6a8f010bd7a3e443ea5c0968de40949facc94b5e6229.css" integrity="sha256-kq9xTKUzqhUsfmqPAQvXo&#43;RD6lwJaN5AlJ&#43;syUteYik=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://loganmarchione.github.io/assets/favicon/favicon_loganmarchione_logo.svg">
<link rel="icon" type="image/png" sizes="16x16" href="https://loganmarchione.github.io/assets/favicon/favicon_loganmarchione_logo.svg">
<link rel="icon" type="image/png" sizes="32x32" href="https://loganmarchione.github.io/assets/favicon/favicon_loganmarchione_logo.svg">
<link rel="apple-touch-icon" href="https://loganmarchione.github.io/assets/favicon/apple-touch-icon.png">
<link rel="mask-icon" href="https://loganmarchione.github.io/assets/favicon/favicon_loganmarchione_logo.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><script async defer data-domain="loganmarchione.com" src="https://plausible.io/js/plausible.js"></script><meta property="og:title" content="Raspberry Pi UPS monitor (with Nginx web monitoring)" />
<meta property="og:description" content="Introduction With the winter weather, we&rsquo;ve been having brownouts and power losses more frequently. I wanted to purchase a UPS to protect my equipment from this, but I also wanted to receive alerts when the power goes out, and possibly shutdown equipment. For this, I need an Uninterruptible Power Supply (UPS) and a computer to monitor it with.
Hardware As you guessed by now, I&rsquo;m going to be using my Raspberry Pi to monitor the UPS." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://loganmarchione.github.io/2017/02/raspberry-pi-ups-monitor-with-nginx-web-monitoring/" />
<meta property="og:image" content="https://loganmarchione.github.io/assets/featured/featured_nut_logo.svg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-02-24T00:00:00+00:00" />
<meta property="article:modified_time" content="2017-02-24T00:00:00+00:00" /><meta property="og:site_name" content="Logan Marchione" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://loganmarchione.github.io/assets/featured/featured_nut_logo.svg" />
<meta name="twitter:title" content="Raspberry Pi UPS monitor (with Nginx web monitoring)"/>
<meta name="twitter:description" content="Introduction With the winter weather, we&rsquo;ve been having brownouts and power losses more frequently. I wanted to purchase a UPS to protect my equipment from this, but I also wanted to receive alerts when the power goes out, and possibly shutdown equipment. For this, I need an Uninterruptible Power Supply (UPS) and a computer to monitor it with.
Hardware As you guessed by now, I&rsquo;m going to be using my Raspberry Pi to monitor the UPS."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://loganmarchione.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Raspberry Pi UPS monitor (with Nginx web monitoring)",
      "item": "https://loganmarchione.github.io/2017/02/raspberry-pi-ups-monitor-with-nginx-web-monitoring/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Raspberry Pi UPS monitor (with Nginx web monitoring)",
  "name": "Raspberry Pi UPS monitor (with Nginx web monitoring)",
  "description": "Introduction With the winter weather, we\u0026rsquo;ve been having brownouts and power losses more frequently. I wanted to purchase a UPS to protect my equipment from this, but I also wanted to receive alerts when the power goes out, and possibly shutdown equipment. For this, I need an Uninterruptible Power Supply (UPS) and a computer to monitor it with.\nHardware As you guessed by now, I\u0026rsquo;m going to be using my Raspberry Pi to monitor the UPS.",
  "keywords": [
    
  ],
  "articleBody": "Introduction With the winter weather, we’ve been having brownouts and power losses more frequently. I wanted to purchase a UPS to protect my equipment from this, but I also wanted to receive alerts when the power goes out, and possibly shutdown equipment. For this, I need an Uninterruptible Power Supply (UPS) and a computer to monitor it with.\nHardware As you guessed by now, I’m going to be using my Raspberry Pi to monitor the UPS. I’m using the Raspberry Pi because it is a low power device, it is always on (hosting a webserver, Unifi controller, and a few other things), and can be run off the UPS it is monitoring.\nThe UPS I’m using is a CyberPower CP1500PFCLCD, specifically, this one. A crucial factor in choosing a UPS is whether you need Pure Sine Wave or Simulated Sine Wave. This decision is based off of the type of power supply in the equipment you’re protecting. Power supplies that use Active Power Factor Correction (Active PFC) typically require Pure Sine Wave, which is shown on the left. Simulated Sine Wave, shown on the right, mimics Pure Sine Wave and is typically cheaper. However, during a switchover to battery power, Simulated Sine Wave has a momentary gap in power (shown in the red circle). During this time, no power is being sent, and Active PFC power supplies may shutdown (which defeats the purpose of the UPS in the first place). In my case, I was happy to be safe instead of sorry, and went for the Pure Sine Wave UPS.\nDisclaimer - I am not an electrical engineer ;-)\nSoftware I need some way to monitor the status of the UPS and act on it if a certain threshold is reached. CyberPower provides software called PowerPanel Personal that runs on Windows, Mac, and Linux. However, it has its limits and cannot be used with anything other than CyberPower devices. Instead, I’m going to be using the Network UPS Tools (NUT) suite. NUT has many advantages over vendor-specific software:\nOpen source, all available on GitHub Supports serial, USB, and network monitoring Supports Windows, Mac, Linux, Unix, BSD, etc… Implements a client/server architecture Configuration The NUT suite consists of three components:\ndriver - connects to and communicates with the UPS server - monitors the UPS status client - sends/receives information from the server The NUT suite offers a variety of configurations. In my case, I’m using the “simple” configuration, also known as standalone. It consists of one UPS and one computer which runs the driver, server, and client. This is the minimum setup needed.\nHowever, you can setup a more advanced configuration consisting of a “master” computer that runs the driver, server, and client, but also have clients running on one or more separate “slave” computers. With this configuration, the master shuts down last, giving the slaves time to shutdown first.\nDriver setup First, connect your UPS to your Raspberry Pi via the included USB cable. Verify you can see it with lsusb.\n--\u003e lsusb Bus 001 Device 005: ID 0764:0501 Cyber Power System, Inc. CP1500 AVR UPS Next, we need to install the NUT suite. Just a warning, the systemd service will fail to start until we make a configuration file.\nsudo apt-get update \u0026\u0026 sudo apt-get install nut nut-client nut-server Over on NUT’s compatibility database, you can see which driver to use for the CP1500PFCLCD (in my case, it was usbhid-ups). Edit the configuration file at /etc/nut/ups.conf and add the following information at the bottom. The friendly name (e.g., cyberpower1) must be one word, no spaces.\n[cyberpower1] driver = usbhid-ups port = auto desc = \"CyberPower CP1500PFCLCD\" Now, start the driver service (this is the same as running upsdrvctl start) and check the status. If it doesn’t start (mine didn’t), a quick reboot will solve the problem.\nsudo systemctl start nut-driver sudo systemctl status nut-driver You should see something like this when checking the status.\nFeb 09 22:05:00 rpi01 upsdrvctl[962]: Using subdriver: CyberPower HID 0.3 Feb 09 22:05:00 rpi01 upsdrvctl[962]: Network UPS Tools - Generic HID driver 0.38 (2.7.2) Feb 09 22:05:00 rpi01 upsdrvctl[962]: USB communication driver 0.32 Feb 09 22:05:01 rpi01 upsdrvctl[962]: Network UPS Tools - UPS driver controller 2.7.2 Feb 09 22:05:01 rpi01 usbhid-ups[964]: Startup successful Server setup Next, we’ll setup the server. Edit the configuration file at /etc/nut/upsd.conf and add a LISTEN directive.\nLISTEN 127.0.0.1 3493 Now, we need to add users to access the server. Edit the configuration file at /etc/nut/upsd.users. Here, I’m adding an admin user and a master user.\n[admin] password = admin1 actions = SET instcmds = ALL [upsmon_local] password = local1 upsmon master Next, we need to set the server to run. Edit the configuration file at /etc/nut/nut.conf to set the mode.\nMODE=standalone Finally, start the server service (this is the same as running upsd) and check the status.\nsudo systemctl start nut-server sudo systemctl status nut-server You can test the connection via localhost (replace cyberpower1 with the friendly name of your UPS).\nsudo upsc cyberpower1@localhost If it worked, you should see something like this.\nInit SSL without certificate database battery.charge: 100 battery.charge.low: 10 battery.charge.warning: 20 battery.mfr.date: CPSlocalhost battery.runtime: 9450 battery.runtime.low: 300 battery.type: PbAcid battery.voltage: 16.0 battery.voltage.nominal: 24 device.mfr: CPS device.model: CP1500PFCLCD device.serial: 000000000000 device.type: ups driver.name: usbhid-ups driver.parameter.pollfreq: 30 driver.parameter.pollinterval: 2 driver.parameter.port: auto driver.version: 2.7.2 driver.version.data: CyberPower HID 0.3 driver.version.internal: 0.38 input.transfer.high: 139 input.transfer.low: 88 input.voltage: 119.0 input.voltage.nominal: 120 output.voltage: 136.0 ups.beeper.status: disabled ups.delay.shutdown: 20 ups.delay.start: 30 ups.load: 2 ups.mfr: CPS ups.model: CP1500PFCLCD ups.productid: 0501 ups.realpower.nominal: 900 ups.serial: 000000000000 ups.status: OL ups.test.result: No test initiated ups.timer.shutdown: -60 ups.timer.start: -60 ups.vendorid: 0764 Client setup Since I’m using the standalone setup, I can make all my connections on localhost. Edit the configuration file at /etc/nut/upsmon.conf and add the connection string, using the master user you created earlier.\nMONITOR cyberpower1@localhost 1 upsmon_local local1 master Ensure your ownership and permissions are correct.\nsudo chown root:nut /etc/nut/* sudo chmod 640 /etc/nut/* Then, start the client service (this is the same as running upsmon) and check the status.\nsudo systemctl start nut-monitor sudo systemctl status nut-monitor You can test the connection via localhost (replace cyberpower1 with the friendly name of your UPS).\nsudo upsc cyberpower1@localhost Web monitoring (Nginx) Assuming you have Nginx installed, you can monitor NUT from the master client via a browser. It’s easier to do this with Apache, but I prefer Nginx. However, unlike Apache, Nginx doesn’t have built in support for executing CGI scripts, so a helper application is needed to handle dynamic content. In this case, that package is fcgiwrap.\nsudo apt-get update \u0026\u0026 sudo apt-get install nut-cgi fcgiwrap Edit the configuration file at /etc/nut/hosts.conf and add the following line (replace cyberpower1 with the friendly name of your UPS).\nMONITOR cyberpower1@localhost \"CyberPower CP1500PFCLCD\" Then, add the necessary location to your Nginx configuration file (this will obviously vary a bit for everyone).\nserver { ... location /nut { alias /usr/share/nut/www/; try_files $uri $uri/ /index.html; } location /cgi-bin/ { gzip off; root /usr/lib; include fastcgi_params; fastcgi_pass unix:/var/run/fcgiwrap.socket; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; } ... } Change ownership of the CGI files and start/restart the necessary services.\nsudo chmod 644 /etc/nut/hosts.conf sudo chmod 644 /etc/nut/*.html sudo chown www-data:www-data /usr/lib/cgi-bin/nut/*.cgi sudo systemctl restart fcgiwrap.service sudo systemctl restart fcgiwrap.socket sudo systemctl restart nginx Then, visit your stats page at http:///nut\nIf you want to visit the settings/admin page, you will need to edit the configuration file at /etc/nut/upsset.conf and uncomment the line below. You can then login with the admin username/password we set earlier.\n###I_HAVE_SECURED_MY_CGI_DIRECTORY Email alerting Email setup Because most ISPs block port 25 (SMTP), we need an external STMP server that we can use to route messages through. Luckily, Google provides one for free if you have a Gmail account. Google’s SMTP settings are here, we’ll need them later. A few protips for this:\nObviously, I would advise against using your primary Gmail account for this. Setting up a dedicated Gmail account just for this application only takes a few minutes and is worth it, in my opinion. If you use 2FA, use an app password instead of your Gmail password. You will also need to Allow less secure apps in your Settings. Start by installing msmtp, a send-only SMTP server that will relay email through Gmail. I chose msmtp over sSMTP because msmtp has sendmail compatibility and sSMTP hasn’t been updated since 2011.\nsudo apt-get update \u0026\u0026 sudo apt-get install msmtp Next, we’re going to edit the configuration file at /etc/msmtprc to include our information. Substitute your new Gmail username and password below.\n# Accounts will inherit settings from this section defaults auth on tls on tls_certcheck on tls_trust_file /etc/ssl/certs/ca-certificates.crt account default host smtp.gmail.com protocol smtp port 587 from your_email@gmail.com user your_email@gmail.com password your_app_password Send a test email to yourself to make sure it works.\nprintf \"Subject: Test Mail\\n\\nThis is a test mail\" | msmtp email@domain.com Alerting setup Edit the configuration file at /etc/nut/upsmon.conf and add the following information. Adjust your alerts accordingly.\nNOTIFYCMD /etc/nut/notifycmd.sh NOTIFYFLAG ONLINE SYSLOG+WALL+EXEC NOTIFYFLAG ONBATT SYSLOG+WALL+EXEC NOTIFYFLAG LOWBATT SYSLOG+WALL+EXEC NOTIFYFLAG FSD SYSLOG+WALL+EXEC NOTIFYFLAG COMMOK SYSLOG+WALL+EXEC NOTIFYFLAG COMMBAD SYSLOG+WALL+EXEC NOTIFYFLAG SHUTDOWN SYSLOG+WALL+EXEC NOTIFYFLAG REPLBATT SYSLOG+WALL+EXEC NOTIFYFLAG NOCOMM SYSLOG+WALL+EXEC NOTIFYFLAG NOPARENT SYSLOG+WALL Next, create the script at /etc/nut/notifycmd.sh.\nsudo touch /etc/nut/notifycmd.sh sudo chown root:nut /etc/nut/* sudo chmod 755 /etc/nut/notifycmd.sh Then, edit it as necessary.\n#!/bin/bash EMAIL='email@domain.com' printf \"Subject: NUT ALERT: $NOTIFYTYPE\\n\\nUPS: $UPSNAME\\r\\nAlert type: $NOTIFYTYPE\" | msmtp $EMAIL Finally, cycle the services.\nsudo systemctl restart nut-driver sudo systemctl restart nut-server sudo systemctl restart nut-monitor Testing Test your email alerts by unplugging the USB cable from the Raspberry Pi and plugging it back in. This action will trigger the COMMBAD and COMMOK flags, which we’ve set to write to the syslog, wall, and execute our script.\nYou can check the syslog, as shown below.\ngrep ups /var/log/syslog You should get a message on any SSH sessions you have open, since we specified to use a wall message.\nBroadcast message from nut@rpi01 (somewhere) (Fri Feb 24 21:59:16 2017): Communications with UPS cyberpower1@localhost lost Broadcast message from nut@rpi01 (somewhere) (Fri Feb 24 21:59:21 2017): Communications with UPS cyberpower1@localhost established You should also get an email for each action.\nCaveat In our setup, upsmon calls our script directly, every time an event takes place.\n---------- ------------------------ | upsmon | ----\u003e | calls your CMDSCRIPT | ---------- ------------------------ The main caveat with this setup is that you may get a notification storm. If the weather is bad and the power goes in and out repeatedly, you’ll get a notification for each event. To mitigate this, NUT has another program called upssched that can call our script, after a specific interval has passed.\n---------- ------------------ ------------------------ | upsmon | ----\u003e | calls upssched | ----\u003e | calls your CMDSCRIPT | ---------- ------------------ ------------------------ Using upssched, we can call our script after the UPS has been on battery for 30 seconds, instead of right away. Then, if the power goes back on in 20 seconds, you can cancel the timer. I haven’t set this up yet, but I’m working on it.\nTweaks After a few days, I noticed I was receiving constant storms of COMMBAD/NOCOMM/COMMOK, even though the power wasn’t going out. After some Google-ing, I stumbled across this article with a solution (copied out below).\nEdit the configuration file at /etc/nut/ups.conf and add a poll interval.\n[cyberpower1] driver = usbhid-ups port = auto desc = \"CyberPower CP1500PFCLCD\" pollinterval = 15 Edit the configuration file at /etc/nut/upsmon.conf and add DEADTIME.\nDEADTIME 25 Edit the configuration file at /etc/nut/upsd.conf and add MAXAGE.\nMAXAGE 25 Finally, cycle the services.\nsudo systemctl restart nut-driver sudo systemctl restart nut-server sudo systemctl restart nut-monitor Apache Because I didn’t have Apache instructions, someone was nice enough to email me an Apache configuration for this. Thanks Kara!\nAlias /nut /usr/share/nut/www ScriptAlias /cgi-bin /usr/lib/cgi-bin ",
  "wordCount" : "1989",
  "inLanguage": "en",
  "image":"https://loganmarchione.github.io/assets/featured/featured_nut_logo.svg","datePublished": "2017-02-24T00:00:00Z",
  "dateModified": "2017-02-24T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Logan Marchione"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://loganmarchione.github.io/2017/02/raspberry-pi-ups-monitor-with-nginx-web-monitoring/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Logan Marchione",
    "logo": {
      "@type": "ImageObject",
      "url": "https://loganmarchione.github.io/assets/favicon/favicon_loganmarchione_logo.svg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://loganmarchione.github.io" accesskey="h" title="Logan Marchione (Alt + H)">
                <img src="https://loganmarchione.github.io/assets/favicon/favicon_loganmarchione_logo.svg" alt="" aria-label="logo"
                    height="35">Logan Marchione</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://loganmarchione.github.io/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://loganmarchione.github.io/privacy" title="Privacy">
                    <span>Privacy</span>
                </a>
            </li>
            <li>
                <a href="https://loganmarchione.github.io/search" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://loganmarchione.github.io/index.xml" title="RSS">
                    <span>RSS</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Raspberry Pi UPS monitor (with Nginx web monitoring)
    </h1>
    <div class="post-meta"><span title='2017-02-24 00:00:00 +0000 UTC'>2017-02-24</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;1989 words&nbsp;·&nbsp;Logan Marchione

</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://loganmarchione.github.io/assets/featured/featured_nut_logo.svg" alt="featured image">
        
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a><ul>
                        
                <li>
                    <a href="#hardware" aria-label="Hardware">Hardware</a></li>
                <li>
                    <a href="#software" aria-label="Software">Software</a></li></ul>
                </li>
                <li>
                    <a href="#configuration" aria-label="Configuration">Configuration</a><ul>
                        
                <li>
                    <a href="#driver-setup" aria-label="Driver setup">Driver setup</a></li>
                <li>
                    <a href="#server-setup" aria-label="Server setup">Server setup</a></li>
                <li>
                    <a href="#client-setup" aria-label="Client setup">Client setup</a></li>
                <li>
                    <a href="#web-monitoring-nginx" aria-label="Web monitoring (Nginx)">Web monitoring (Nginx)</a></li></ul>
                </li>
                <li>
                    <a href="#email-alerting" aria-label="Email alerting">Email alerting</a><ul>
                        
                <li>
                    <a href="#email-setup" aria-label="Email setup">Email setup</a></li>
                <li>
                    <a href="#alerting-setup" aria-label="Alerting setup">Alerting setup</a></li>
                <li>
                    <a href="#testing" aria-label="Testing">Testing</a></li></ul>
                </li>
                <li>
                    <a href="#caveat" aria-label="Caveat">Caveat</a></li>
                <li>
                    <a href="#tweaks" aria-label="Tweaks">Tweaks</a></li>
                <li>
                    <a href="#apache" aria-label="Apache">Apache</a></li>
                <li>
                    <a href="#comments" aria-label="Comments">Comments</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h1>
<p>With the winter weather, we&rsquo;ve been having brownouts and power losses more frequently. I wanted to purchase a UPS to protect my equipment from this, but I also wanted to receive alerts when the power goes out, and possibly shutdown equipment. For this, I need an <a href="https://en.wikipedia.org/wiki/Uninterruptible_power_supply">Uninterruptible Power Supply</a> (UPS) and a computer to monitor it with.</p>
<h2 id="hardware">Hardware<a hidden class="anchor" aria-hidden="true" href="#hardware">#</a></h2>
<p>As you guessed by now, I&rsquo;m going to be using my Raspberry Pi to monitor the UPS. I&rsquo;m using the Raspberry Pi because it is a low power device, it is always on (hosting a webserver, <a href="/2016/11/ubiquiti-unifi-controller-setup-raspberry-pi-3/">Unifi controller</a>, and a few other things), and can be run off the UPS it is monitoring.</p>
<p>The UPS I&rsquo;m using is a CyberPower CP1500PFCLCD, specifically, <a href="http://a.co/j5Udt7f">this one</a>. A crucial factor in choosing a UPS is whether you need Pure Sine Wave or Simulated Sine Wave. This decision is based off of the type of power supply in the equipment you&rsquo;re protecting. Power supplies that use Active Power Factor Correction (Active PFC) typically require Pure Sine Wave, which is shown on the left. Simulated Sine Wave, shown on the right, mimics Pure Sine Wave and is typically cheaper. However, during a switchover to battery power, Simulated Sine Wave has a momentary gap in power (shown in the red circle). During this time, no power is being sent, and Active PFC power supplies may shutdown (which defeats the purpose of the UPS in the first place). In my case, I was happy to be safe instead of sorry, and went for the Pure Sine Wave UPS.</p>

<p><img src="/2017/02/raspberry-pi-ups-monitor-with-nginx-web-monitoring/20170209_001.png" loading="lazy" alt="sine wave"></p>

<p><img src="/2017/02/raspberry-pi-ups-monitor-with-nginx-web-monitoring/20170209_002.png" loading="lazy" alt="sine wave"></p>
<p>Disclaimer - I am not an electrical engineer ;-)</p>
<h2 id="software">Software<a hidden class="anchor" aria-hidden="true" href="#software">#</a></h2>
<p>I need some way to monitor the status of the UPS and act on it if a certain threshold is reached. CyberPower provides software called <a href="https://www.cyberpowersystems.com/products/software/power-panel-personal/">PowerPanel Personal</a> that runs on Windows, Mac, and Linux. However, it has its limits and cannot be used with anything other than CyberPower devices. Instead, I&rsquo;m going to be using the <a href="http://networkupstools.org/">Network UPS Tools</a> (NUT) suite. NUT has many advantages over vendor-specific software:</p>
<ul>
<li>Open source, all available on <a href="https://github.com/networkupstools/nut/">GitHub</a></li>
<li>Supports serial, USB, and network monitoring</li>
<li>Supports Windows, Mac, Linux, Unix, BSD, etc&hellip;</li>
<li>Implements a client/server architecture</li>
</ul>
<h1 id="configuration">Configuration<a hidden class="anchor" aria-hidden="true" href="#configuration">#</a></h1>
<p>The NUT suite consists of three components:</p>
<ul>
<li>driver - connects to and communicates with the UPS</li>
<li>server - monitors the UPS status</li>
<li>client  - sends/receives information from the server</li>
</ul>
<p>The NUT suite offers a <a href="http://networkupstools.org/features.html#_monitoring_diagrams">variety of configurations</a>. In my case, I&rsquo;m using the &ldquo;simple&rdquo; configuration, also known as <em>standalone</em>. It consists of one UPS and one computer which runs the driver, server, and client. This is the minimum setup needed.</p>

<p><img src="/2017/02/raspberry-pi-ups-monitor-with-nginx-web-monitoring/20170209_003.png" loading="lazy" alt="nut configuration"></p>
<p>However, you can setup a more advanced configuration consisting of a &ldquo;master&rdquo; computer that runs the driver, server, and client, but also have clients running on one or more separate &ldquo;slave&rdquo; computers. With this configuration, the master shuts down last, giving the slaves time to shutdown first.</p>

<p><img src="/2017/02/raspberry-pi-ups-monitor-with-nginx-web-monitoring/20170209_004.png" loading="lazy" alt="nut configuration"></p>
<h2 id="driver-setup">Driver setup<a hidden class="anchor" aria-hidden="true" href="#driver-setup">#</a></h2>
<p>First, connect your UPS to your Raspberry Pi via the included USB cable. Verify you can see it with <em>lsusb</em>.</p>
<pre tabindex="0"><code>--&gt; lsusb
Bus 001 Device 005: ID 0764:0501 Cyber Power System, Inc. CP1500 AVR UPS
</code></pre><p>Next, we need to install the NUT suite. Just a warning, the systemd service will fail to start until we make a configuration file.</p>
<pre tabindex="0"><code>sudo apt-get update &amp;&amp; sudo apt-get install nut nut-client nut-server
</code></pre><p>Over on NUT&rsquo;s <a href="http://networkupstools.org/stable-hcl.html">compatibility database</a>, you can see which <a href="http://networkupstools.org/ddl/Cyber_Power_Systems/CP1500PFCLCD.html">driver</a> to use for the CP1500PFCLCD (in my case, it was <em>usbhid-ups</em>). Edit the configuration file at <em>/etc/nut/ups.conf</em>  and add the following information at the bottom. The friendly name (e.g., <em>cyberpower1</em>) must be one word, no spaces.</p>
<pre tabindex="0"><code>[cyberpower1]
        driver = usbhid-ups
        port = auto
        desc = &#34;CyberPower CP1500PFCLCD&#34;
</code></pre><p>Now, start the driver service (this is the same as running <em>upsdrvctl start</em>) and check the status. If it doesn&rsquo;t start (mine didn&rsquo;t), a quick reboot will solve the problem.</p>
<pre tabindex="0"><code>sudo systemctl start nut-driver
sudo systemctl status nut-driver
</code></pre><p>You should see something like this when checking the status.</p>
<pre tabindex="0"><code>Feb 09 22:05:00 rpi01 upsdrvctl[962]: Using subdriver: CyberPower HID 0.3
Feb 09 22:05:00 rpi01 upsdrvctl[962]: Network UPS Tools - Generic HID driver 0.38 (2.7.2)
Feb 09 22:05:00 rpi01 upsdrvctl[962]: USB communication driver 0.32
Feb 09 22:05:01 rpi01 upsdrvctl[962]: Network UPS Tools - UPS driver controller 2.7.2
Feb 09 22:05:01 rpi01 usbhid-ups[964]: Startup successful
</code></pre><h2 id="server-setup">Server setup<a hidden class="anchor" aria-hidden="true" href="#server-setup">#</a></h2>
<p>Next, we&rsquo;ll setup the server. Edit the configuration file at <em>/etc/nut/upsd.conf</em> and add a <em>LISTEN</em> directive.</p>
<pre tabindex="0"><code>LISTEN 127.0.0.1 3493
</code></pre><p>Now, we need to add users to access the server. Edit the configuration file at <em>/etc/nut/upsd.users</em>. Here, I&rsquo;m adding an admin user and a master user.</p>
<pre tabindex="0"><code>[admin]
        password = admin1
        actions = SET
        instcmds = ALL
[upsmon_local]
        password  = local1
        upsmon master
</code></pre><p>Next, we need to set the server to run. Edit the configuration file at <em>/etc/nut/nut.conf</em> to set the mode.</p>
<pre tabindex="0"><code>MODE=standalone
</code></pre><p>Finally, start the server service (this is the same as running <em>upsd</em>) and check the status.</p>
<pre tabindex="0"><code>sudo systemctl start nut-server
sudo systemctl status nut-server
</code></pre><p>You can test the connection via <em>localhost</em> (replace <em>cyberpower1</em> with the friendly name of your UPS).</p>
<pre tabindex="0"><code>sudo upsc cyberpower1@localhost
</code></pre><p>If it worked, you should see something like this.</p>
<pre tabindex="0"><code>Init SSL without certificate database
battery.charge: 100
battery.charge.low: 10
battery.charge.warning: 20
battery.mfr.date: CPSlocalhost
battery.runtime: 9450
battery.runtime.low: 300
battery.type: PbAcid
battery.voltage: 16.0
battery.voltage.nominal: 24
device.mfr: CPS
device.model: CP1500PFCLCD
device.serial: 000000000000
device.type: ups
driver.name: usbhid-ups
driver.parameter.pollfreq: 30
driver.parameter.pollinterval: 2
driver.parameter.port: auto
driver.version: 2.7.2
driver.version.data: CyberPower HID 0.3
driver.version.internal: 0.38
input.transfer.high: 139
input.transfer.low: 88
input.voltage: 119.0
input.voltage.nominal: 120
output.voltage: 136.0
ups.beeper.status: disabled
ups.delay.shutdown: 20
ups.delay.start: 30
ups.load: 2
ups.mfr: CPS
ups.model: CP1500PFCLCD
ups.productid: 0501
ups.realpower.nominal: 900
ups.serial: 000000000000
ups.status: OL
ups.test.result: No test initiated
ups.timer.shutdown: -60
ups.timer.start: -60
ups.vendorid: 0764
</code></pre><h2 id="client-setup">Client setup<a hidden class="anchor" aria-hidden="true" href="#client-setup">#</a></h2>
<p>Since I&rsquo;m using the <em>standalone</em> setup, I can make all my connections on <em>localhost</em>. Edit the configuration file at <em>/etc/nut/upsmon.conf</em> and add the connection string, using the master user you created earlier.</p>
<pre tabindex="0"><code>MONITOR cyberpower1@localhost 1 upsmon_local local1 master
</code></pre><p>Ensure your ownership and permissions are correct.</p>
<pre tabindex="0"><code>sudo chown root:nut /etc/nut/*
sudo chmod 640 /etc/nut/*
</code></pre><p>Then, start the client service (this is the same as running <em>upsmon</em>) and check the status.</p>
<pre tabindex="0"><code>sudo systemctl start nut-monitor
sudo systemctl status nut-monitor
</code></pre><p>You can test the connection via <em>localhost</em> (replace <em>cyberpower1</em> with the friendly name of your UPS).</p>
<pre tabindex="0"><code>sudo upsc cyberpower1@localhost
</code></pre><h2 id="web-monitoring-nginx">Web monitoring (Nginx)<a hidden class="anchor" aria-hidden="true" href="#web-monitoring-nginx">#</a></h2>
<p>Assuming you have Nginx installed, you can monitor NUT from the master client via a browser. It&rsquo;s easier to do this with Apache, but I prefer Nginx. However, unlike Apache, Nginx doesn&rsquo;t have built in support for executing CGI scripts, so a helper application is needed to handle dynamic content. In this case, that package is <em>fcgiwrap</em>.</p>
<pre tabindex="0"><code>sudo apt-get update &amp;&amp; sudo apt-get install nut-cgi fcgiwrap
</code></pre><p>Edit the configuration file at <em>/etc/nut/hosts.conf</em> and add the following line (replace <em>cyberpower1</em> with the friendly name of your UPS).</p>
<pre tabindex="0"><code>MONITOR cyberpower1@localhost &#34;CyberPower CP1500PFCLCD&#34;
</code></pre><p>Then, add the necessary location to your Nginx configuration file (this will obviously vary a bit for everyone).</p>
<pre tabindex="0"><code>server {
...
        location /nut {
        alias /usr/share/nut/www/;
        try_files $uri $uri/ /index.html;
        }

        location /cgi-bin/ {
                gzip off;
                root /usr/lib;

                include fastcgi_params;
                fastcgi_pass unix:/var/run/fcgiwrap.socket;
                fastcgi_param SCRIPT_FILENAME  $document_root$fastcgi_script_name;
        }
...
}
</code></pre><p>Change ownership of the CGI files and start/restart the necessary services.</p>
<pre tabindex="0"><code>sudo chmod 644 /etc/nut/hosts.conf
sudo chmod 644 /etc/nut/*.html
sudo chown www-data:www-data /usr/lib/cgi-bin/nut/*.cgi
sudo systemctl restart fcgiwrap.service
sudo systemctl restart fcgiwrap.socket
sudo systemctl restart nginx
</code></pre><p>Then, visit your stats page at <code>http://&lt;your_IP&gt;/nut</code></p>

<p><img src="/2017/02/raspberry-pi-ups-monitor-with-nginx-web-monitoring/20170209_005.png" loading="lazy" alt="screenshot"></p>

<p><img src="/2017/02/raspberry-pi-ups-monitor-with-nginx-web-monitoring/20170209_006.png" loading="lazy" alt="screenshot"></p>
<p>If you want to visit the settings/admin page, you will need to edit the configuration file at <em>/etc/nut/upsset.conf</em> and uncomment the line below. You can then login with the admin username/password we set earlier.</p>
<pre tabindex="0"><code>###I_HAVE_SECURED_MY_CGI_DIRECTORY
</code></pre><h1 id="email-alerting">Email alerting<a hidden class="anchor" aria-hidden="true" href="#email-alerting">#</a></h1>
<h2 id="email-setup">Email setup<a hidden class="anchor" aria-hidden="true" href="#email-setup">#</a></h2>
<p>Because most ISPs block port 25 (SMTP), we need an external STMP server that we can use to route messages through. Luckily, Google provides one for free if you have a Gmail account. Google&rsquo;s SMTP settings are <a href="https://support.google.com/a/answer/176600?hl=en">here</a>, we&rsquo;ll need them later. A few protips for this:</p>
<ol>
<li>Obviously, I would advise against using your primary Gmail account for this. Setting up a dedicated Gmail account just for this application only takes a few minutes and is worth it, in my opinion.</li>
<li>If you use 2FA, use an <a href="https://support.google.com/mail/answer/185833?hl=en">app password</a> instead of your Gmail password.</li>
<li>You will also need to <em>Allow less secure apps</em> in your <a href="https://myaccount.google.com/security#connectedapps">Settings</a>.</li>
</ol>
<p>Start by installing msmtp, a send-only SMTP server that will relay email through Gmail. I chose msmtp over sSMTP because msmtp has sendmail compatibility and sSMTP hasn&rsquo;t been updated since 2011.</p>
<pre tabindex="0"><code>sudo apt-get update &amp;&amp; sudo apt-get install msmtp
</code></pre><p>Next, we&rsquo;re going to edit the configuration file at <em>/etc/msmtprc</em> to include our information. Substitute your new Gmail username and password below.</p>
<pre tabindex="0"><code># Accounts will inherit settings from this section
defaults
auth            on
tls             on
tls_certcheck   on
tls_trust_file  /etc/ssl/certs/ca-certificates.crt

account   default 
host      smtp.gmail.com
protocol  smtp
port      587
from      your_email@gmail.com
user      your_email@gmail.com
password  your_app_password
</code></pre><p>Send a test email to yourself to make sure it works.</p>
<pre tabindex="0"><code>printf &#34;Subject: Test Mail\n\nThis is a test mail&#34; | msmtp email@domain.com
</code></pre><h2 id="alerting-setup">Alerting setup<a hidden class="anchor" aria-hidden="true" href="#alerting-setup">#</a></h2>
<p>Edit the configuration file at <em>/etc/nut/upsmon.conf</em> and add the following information. Adjust your alerts accordingly.</p>
<pre tabindex="0"><code>NOTIFYCMD /etc/nut/notifycmd.sh
NOTIFYFLAG ONLINE     SYSLOG+WALL+EXEC
NOTIFYFLAG ONBATT     SYSLOG+WALL+EXEC
NOTIFYFLAG LOWBATT    SYSLOG+WALL+EXEC
NOTIFYFLAG FSD        SYSLOG+WALL+EXEC
NOTIFYFLAG COMMOK     SYSLOG+WALL+EXEC
NOTIFYFLAG COMMBAD    SYSLOG+WALL+EXEC
NOTIFYFLAG SHUTDOWN   SYSLOG+WALL+EXEC
NOTIFYFLAG REPLBATT   SYSLOG+WALL+EXEC
NOTIFYFLAG NOCOMM     SYSLOG+WALL+EXEC
NOTIFYFLAG NOPARENT   SYSLOG+WALL
</code></pre><p>Next, create the script at <em>/etc/nut/notifycmd.sh</em>.</p>
<pre tabindex="0"><code>sudo touch /etc/nut/notifycmd.sh
sudo chown root:nut /etc/nut/*
sudo chmod 755 /etc/nut/notifycmd.sh
</code></pre><p>Then, edit it as necessary.</p>
<pre tabindex="0"><code>#!/bin/bash
EMAIL=&#39;email@domain.com&#39;
printf &#34;Subject: NUT ALERT: $NOTIFYTYPE\n\nUPS: $UPSNAME\r\nAlert type: $NOTIFYTYPE&#34; | msmtp $EMAIL
</code></pre><p>Finally, cycle the services.</p>
<pre tabindex="0"><code>sudo systemctl restart nut-driver
sudo systemctl restart nut-server
sudo systemctl restart nut-monitor
</code></pre><h2 id="testing">Testing<a hidden class="anchor" aria-hidden="true" href="#testing">#</a></h2>
<p>Test your email alerts by unplugging the USB cable from the Raspberry Pi and plugging it back in. This action will trigger the <em>COMMBAD</em> and <em>COMMOK</em> flags, which we&rsquo;ve set to write to the syslog, wall, and execute our script.</p>
<p>You can check the syslog, as shown below.</p>
<pre tabindex="0"><code>grep ups /var/log/syslog
</code></pre><p>You should get a message on any SSH sessions you have open, since we specified to use a wall message.</p>
<pre tabindex="0"><code>Broadcast message from nut@rpi01 (somewhere) (Fri Feb 24 21:59:16                                                                     2017):
                                                                                                                                      
Communications with UPS cyberpower1@localhost lost                                                                                    
                                                                                                                                      
                                                                                                                                      
Broadcast message from nut@rpi01 (somewhere) (Fri Feb 24 21:59:21                                                                     2017):
                                                                                                                                      
Communications with UPS cyberpower1@localhost established
</code></pre><p>You should also get an email for each action.</p>

<p><img src="/2017/02/raspberry-pi-ups-monitor-with-nginx-web-monitoring/20170209_007.png" loading="lazy" alt="nut configuration"></p>
<h1 id="caveat">Caveat<a hidden class="anchor" aria-hidden="true" href="#caveat">#</a></h1>
<p>In our setup, upsmon calls our script directly, every time an event takes place.</p>
<pre tabindex="0"><code>----------       ------------------------
| upsmon | ----&gt; | calls your CMDSCRIPT |
----------       ------------------------
</code></pre><p>The main caveat with this setup is that you may get a <a href="http://networkupstools.org/docs/user-manual.chunked/ar01s07.html#_suppressing_notify_storms">notification storm</a>. If the weather is bad and the power goes in and out repeatedly, you&rsquo;ll get a notification for each event. To mitigate this, NUT has another program called <a href="http://networkupstools.org/docs/user-manual.chunked/ar01s07.html#_the_advanced_approach_using_upssched">upssched</a> that can call our script, after a specific interval has passed.</p>
<pre tabindex="0"><code>----------       ------------------       ------------------------
| upsmon | ----&gt; | calls upssched | ----&gt; | calls your CMDSCRIPT |
----------       ------------------       ------------------------
</code></pre><p>Using upssched, we can call our script after the UPS has been on battery for 30 seconds, instead of right away. Then, if the power goes back on in 20 seconds, you can cancel the timer. I haven&rsquo;t set this up yet, but I&rsquo;m working on it.</p>
<h1 id="tweaks">Tweaks<a hidden class="anchor" aria-hidden="true" href="#tweaks">#</a></h1>
<p>After a few days, I noticed I was receiving constant storms of COMMBAD/NOCOMM/COMMOK, even though the power wasn&rsquo;t going out. After some Google-ing, I stumbled across <a href="https://nmaggioni.xyz/2017/03/14/NUT-CyberPower-UPS/#NUT-Settings">this</a> article with a solution (copied out below).</p>
<p>Edit the configuration file at <em>/etc/nut/ups.conf</em>  and add a poll interval.</p>
<pre tabindex="0"><code>[cyberpower1]
 driver = usbhid-ups
 port = auto
 desc = &#34;CyberPower CP1500PFCLCD&#34;
 pollinterval = 15
</code></pre><p>Edit the configuration file at <em>/etc/nut/upsmon.conf</em> and add <em>DEADTIME</em>.</p>
<pre tabindex="0"><code>DEADTIME 25
</code></pre><p>Edit the configuration file at <em>/etc/nut/upsd.conf</em> and add <em>MAXAGE</em>.</p>
<pre tabindex="0"><code>MAXAGE 25
</code></pre><p>Finally, cycle the services.</p>
<pre tabindex="0"><code>sudo systemctl restart nut-driver
sudo systemctl restart nut-server
sudo systemctl restart nut-monitor
</code></pre><h1 id="apache">Apache<a hidden class="anchor" aria-hidden="true" href="#apache">#</a></h1>
<p>Because I didn&rsquo;t have Apache instructions, someone was nice enough to email me an Apache configuration for this. Thanks Kara!</p>
<pre tabindex="0"><code>&lt;VirtualHost *:80&gt;
      Alias /nut /usr/share/nut/www
      ScriptAlias /cgi-bin /usr/lib/cgi-bin
      &lt;Directory &#34;/usr/lib/cgi-bin&#34;&gt;
            AddHandler cgi-script .py
            AllowOverride None
            Options +ExecCGI -MultiViews +SymLinksIfOwnerMatch
            Order allow,deny
            Allow from all
      &lt;/Directory&gt;
&lt;/VirtualHost&gt;
</code></pre><p>Let me know how this works for you!</p>
<p>-Logan</p>
<h1 id="comments">Comments<a hidden class="anchor" aria-hidden="true" href="#comments">#</a></h1>
<p><a href="/2017/02/raspberry-pi-ups-monitor-with-nginx-web-monitoring/comments.txt">Old comments from WordPress</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>

<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Raspberry Pi UPS monitor (with Nginx web monitoring) on twitter"
        href="https://twitter.com/intent/tweet/?text=Raspberry%20Pi%20UPS%20monitor%20%28with%20Nginx%20web%20monitoring%29&amp;url=https%3a%2f%2floganmarchione.github.io%2f2017%2f02%2fraspberry-pi-ups-monitor-with-nginx-web-monitoring%2f&amp;hashtags=">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Raspberry Pi UPS monitor (with Nginx web monitoring) on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2floganmarchione.github.io%2f2017%2f02%2fraspberry-pi-ups-monitor-with-nginx-web-monitoring%2f&amp;title=Raspberry%20Pi%20UPS%20monitor%20%28with%20Nginx%20web%20monitoring%29&amp;summary=Raspberry%20Pi%20UPS%20monitor%20%28with%20Nginx%20web%20monitoring%29&amp;source=https%3a%2f%2floganmarchione.github.io%2f2017%2f02%2fraspberry-pi-ups-monitor-with-nginx-web-monitoring%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Raspberry Pi UPS monitor (with Nginx web monitoring) on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2floganmarchione.github.io%2f2017%2f02%2fraspberry-pi-ups-monitor-with-nginx-web-monitoring%2f&title=Raspberry%20Pi%20UPS%20monitor%20%28with%20Nginx%20web%20monitoring%29">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Raspberry Pi UPS monitor (with Nginx web monitoring) on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2floganmarchione.github.io%2f2017%2f02%2fraspberry-pi-ups-monitor-with-nginx-web-monitoring%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Raspberry Pi UPS monitor (with Nginx web monitoring) on whatsapp"
        href="https://api.whatsapp.com/send?text=Raspberry%20Pi%20UPS%20monitor%20%28with%20Nginx%20web%20monitoring%29%20-%20https%3a%2f%2floganmarchione.github.io%2f2017%2f02%2fraspberry-pi-ups-monitor-with-nginx-web-monitoring%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Raspberry Pi UPS monitor (with Nginx web monitoring) on telegram"
        href="https://telegram.me/share/url?text=Raspberry%20Pi%20UPS%20monitor%20%28with%20Nginx%20web%20monitoring%29&amp;url=https%3a%2f%2floganmarchione.github.io%2f2017%2f02%2fraspberry-pi-ups-monitor-with-nginx-web-monitoring%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2023 <a href="https://loganmarchione.github.io">Logan Marchione</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><div class="kb-club">
  <a target="_blank" href="https://512kb.club"><img src="/assets/assets/512kb-club-green-team.svg" alt="512kb club badge"></a>
</div>


<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
