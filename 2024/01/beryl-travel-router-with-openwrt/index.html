<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Beryl travel router with OpenWrt | Logan Marchione</title>
<meta name="keywords" content="">
<meta name="description" content="Hey! Listen! This post is part of a series on using OpenWrt. Check them all out!
Date URL Part 2024-01-31 Beryl travel router with OpenWrt OpenWrt revisited 2016-04-28 OpenWrt upgrade process OpenWrt upgrade 2015-08-26 OpenWrt with OpenVPN server on TP-Link Archer C7 Initial post 2015-02-15 OpenWrt with OpenVPN client on TP-Link TL-MR3020 Initial post Introduction It&rsquo;s been over seven years since I last touched OpenWrt. &#x1f92f;
I&rsquo;ve been on a couple trips in the last month and needed a way to share a single internet connection with multiple devices (e.">
<meta name="author" content="Logan Marchione">
<link rel="canonical" href="https://loganmarchione.github.io/2024/01/beryl-travel-router-with-openwrt/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.4117d964c20f142572c34772d5a912b3681e6e9317e9f2de59739813b764caeb.css" integrity="sha256-QRfZZMIPFCVyw0dy1akSs2gebpMX6fLeWXOYE7dkyus=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://loganmarchione.github.io/assets/favicon/favicon_loganmarchione_logo.svg">
<link rel="icon" type="image/png" sizes="16x16" href="https://loganmarchione.github.io/assets/favicon/favicon_loganmarchione_logo.svg">
<link rel="icon" type="image/png" sizes="32x32" href="https://loganmarchione.github.io/assets/favicon/favicon_loganmarchione_logo.svg">
<link rel="apple-touch-icon" href="https://loganmarchione.github.io/assets/favicon/apple-touch-icon.png">
<link rel="mask-icon" href="https://loganmarchione.github.io/assets/favicon/favicon_loganmarchione_logo.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><script async defer data-domain="loganmarchione.com" src="https://plausible.io/js/plausible.js"></script><meta property="og:title" content="Beryl travel router with OpenWrt" />
<meta property="og:description" content="Hey! Listen! This post is part of a series on using OpenWrt. Check them all out!
Date URL Part 2024-01-31 Beryl travel router with OpenWrt OpenWrt revisited 2016-04-28 OpenWrt upgrade process OpenWrt upgrade 2015-08-26 OpenWrt with OpenVPN server on TP-Link Archer C7 Initial post 2015-02-15 OpenWrt with OpenVPN client on TP-Link TL-MR3020 Initial post Introduction It&rsquo;s been over seven years since I last touched OpenWrt. &#x1f92f;
I&rsquo;ve been on a couple trips in the last month and needed a way to share a single internet connection with multiple devices (e." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://loganmarchione.github.io/2024/01/beryl-travel-router-with-openwrt/" />
<meta property="og:image" content="https://loganmarchione.github.io/assets/featured/featured_openwrt_new.svg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-01-01T00:00:00+00:00" /><meta property="og:site_name" content="Logan Marchione" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://loganmarchione.github.io/assets/featured/featured_openwrt_new.svg" />
<meta name="twitter:title" content="Beryl travel router with OpenWrt"/>
<meta name="twitter:description" content="Hey! Listen! This post is part of a series on using OpenWrt. Check them all out!
Date URL Part 2024-01-31 Beryl travel router with OpenWrt OpenWrt revisited 2016-04-28 OpenWrt upgrade process OpenWrt upgrade 2015-08-26 OpenWrt with OpenVPN server on TP-Link Archer C7 Initial post 2015-02-15 OpenWrt with OpenVPN client on TP-Link TL-MR3020 Initial post Introduction It&rsquo;s been over seven years since I last touched OpenWrt. &#x1f92f;
I&rsquo;ve been on a couple trips in the last month and needed a way to share a single internet connection with multiple devices (e."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Posts",
      "item": "https://loganmarchione.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "Beryl travel router with OpenWrt",
      "item": "https://loganmarchione.github.io/2024/01/beryl-travel-router-with-openwrt/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Beryl travel router with OpenWrt",
  "name": "Beryl travel router with OpenWrt",
  "description": "Hey! Listen! This post is part of a series on using OpenWrt. Check them all out!\nDate URL Part 2024-01-31 Beryl travel router with OpenWrt OpenWrt revisited 2016-04-28 OpenWrt upgrade process OpenWrt upgrade 2015-08-26 OpenWrt with OpenVPN server on TP-Link Archer C7 Initial post 2015-02-15 OpenWrt with OpenVPN client on TP-Link TL-MR3020 Initial post Introduction It\u0026rsquo;s been over seven years since I last touched OpenWrt. \u0026#x1f92f;\nI\u0026rsquo;ve been on a couple trips in the last month and needed a way to share a single internet connection with multiple devices (e.",
  "keywords": [
    
  ],
  "articleBody": "Hey! Listen! This post is part of a series on using OpenWrt. Check them all out!\nDate URL Part 2024-01-31 Beryl travel router with OpenWrt OpenWrt revisited 2016-04-28 OpenWrt upgrade process OpenWrt upgrade 2015-08-26 OpenWrt with OpenVPN server on TP-Link Archer C7 Initial post 2015-02-15 OpenWrt with OpenVPN client on TP-Link TL-MR3020 Initial post Introduction It’s been over seven years since I last touched OpenWrt. 🤯\nI’ve been on a couple trips in the last month and needed a way to share a single internet connection with multiple devices (e.g., Steam Deck, laptops, phones, etc…). I thought it would be fun to setup OpenWrt on a travel router and to revisit OpenWrt to see what’s changed.\nDesign Network overview The idea here was to connect one device to my hotel’s WiFi, and then connect all of my other devices to that device. In this case, I put my own OpenWrt router behind the hotel’s router.\nThis device is a proper router/firewall and would be useful for a situation where you either need to share a single internet connection with multiple devices, or where you don’t trust the upstream connection:\npaying for in-flight WiFi and sharing it with your other devices (although, I’m sure this is against some terms of service) a dorm/apartment/hotel where a shared network is provided by building management and you don’t 100% trust it physical network segmentation (as opposed to VLANs) My desired setup was below.\nHardware The trick with OpenWrt is not to get hardware that is too old (because it will have bad specs and be slow), but also not get something that is too new (because it won’t be supported yet).\nI was looking for something that had the following features:\nphysically small (it’s for travel, after all) good OpenWrt support (preferably with stable support, not snapshot images) dual-core CPU at least 128MB of RAM at least 16MB of flash storage (so I’m not having to expand storage onto an extroot like I used to do) at least two ethernet ports (WAN and LAN) at least two radios (WAN and LAN) preferably had USB-C power input preferably had 802.11ac (WiFi 5) It just so happened that GL.iNet makes a bunch of full-size and travel routers that all run a custom version of OpenWrt. This was a great starting place, and I started looking at the OpenWrt Table of Hardware (ToH). The GL.iNet hardware was perfectly suited to my use case, so it was just a matter of picking a model that had the specs I wanted and was easily available. I ended up choosing the Beryl (GL-MT1300).\nImage from GL.iNet\nImage from GL.iNet\nImage from GL.iNet\nImage from GL.iNet\nImage from GL.iNet\nI also considered these models:\nMikroTik mAP Raspberry Pi 4 (like NetworkChuck used) TP-Link TL-WR902AC (this appears to be an upgraded version of the TL-MR3020 that I used to have) One of the various FriendlyElec NanoPi boards the newer Beryl AX (GL-MT3000) (isn’t yet supported by OpenWrt) the Slate Plus (GL-A1300) Software GL.iNet’s routers all run a custom version of OpenWrt. I’m unsure if the core OpenWrt code is stock, but at the very least, they run a proprietary (i.e., closed-source) UI on top of OpenWrt (although they do still let you access LuCI). Their UI looks great and exposes a bunch of one-click options that simplify setup.\nOpenVPN client/server WireGuard client/server Repeater 3G/4G modem Tethering Captive portal Dynamic DNS (DDNS) Hardware button settings This is the 3.x version of the UI.\nThis is the 4.x version of the UI.\nUnfortunately, this is the part where I mention that GL.iNet is a Chinese company, if that kind of thing bothers you. Regardless of that, I’d never run anything proprietary for something that’s controlling access to my network, so my plan was always to immediately replace GL.iNet’s version of OpenWrt with the stock version.\nSetup Install OpenWrt OpenWrt has two kinds of installations:\ninstalling from vendor firmware (called a factory installation) upgrading OpenWrt (called a sysupgrade) Because the Beryl already ran a version of OpenWrt from GL.iNet, I needed to do a sysupgrade. The installation process was pretty simple, and I’ve summarized the steps from the wiki page for the Beryl:\nOn my laptop, I went to the OpenWrt Firmware Selector (this was much easier than navigating the firmware directories), found my model, downloaded the sysupgrade file, and verified the sha256 hash of the file Connected to the Beryl’s LAN port (which after booting, gave me an IP in the 192.168.8.x range) Browsed to http://192.168.8.1/, went through the setup wizard, then browsed to http://192.168.8.1/#/upgrade and uploaded the sysupgrade file Hit an error that read failed! ERROR: Incorrect firmware format! Upgraded the factory firmware from 3.211 to 3.216 to 4.3.7 from this page Repeated step 3, waited 5 mins, and rebooted into OpenWrt at https://192.168.1.1/! Configure OpenWrt OpenWrt has a really great configuration system. It stores its configuration files in /etc/config in a system known as the Unified Configuration Interface (UCI). The UCI is basically a collection of easy-to-read configuration files that are all centrally located, making OpenWrt much easier to configure. You can edit these files manually with vi or nano, but there is also a command line tool called uci that you can use to edit the files (great for scripting).\nThe web interface for OpenWrt is called LuCI (I’m guessing it’s short for Lua UCI, because it’s written in Lua). What’s nice about LuCI is that it reads/writes from/to the UCI files. Any changes you make in LuCI are reflected in the UCI files, and vice versa, meaning you can configure OpenWrt from the web interface, or from the command line.\nInitial login Navigate to https://192.168.1.1/ in your browser and you’ll be greeted by an SSL error. This is because the web interface uses a self-signed certificate out of the box. It’s safe to click through this, since your traffic is encrypted and you know the certificate is from the router (or you can browse to http://192.168.1.1/ without HTTPS).\nMoving on. Leave the username as “root” and the password field empty.\nClick on Login to continue and you’ll see the status page.\nSet a password From the main status page, we’re going to set a root password by using the link in the yellow box at the top of the page. Here, you can (and should) set a root password. Click on Save to continue.\nYou can now SSH into the router with those credentials.\n\u003e ssh root@192.168.1.1 root@192.168.1.1's password: BusyBox v1.36.1 (2023-11-14 13:38:11 UTC) built-in shell (ash) _______ ________ __ | |.-----.-----.-----.| | | |.----.| |_ | - || _ | -__| || | | || _|| _| |_______|| __|_____|__|__||________||__| |____| |__| W I R E L E S S F R E E D O M ----------------------------------------------------- OpenWrt 23.05.2, r23630-842932a63d ----------------------------------------------------- root@OpenWrt:~# Set hostname First, set a hostname for the device and reboot.\nuci set system.@system[0].hostname='OpenWrt_TR' uci commit system reboot Secure SSH SSH is listening on all interfaces (LAN and WAN). I like to only be able to SSH via the LAN interface. Use the commands below to change that.\nuci set dropbear.@dropbear[0].Interface='lan' uci commit dropbear service dropbear restart LAN settings Next, we’re going to change the default IP of the router from 192.168.1.1 to 10.70.74.1 (or whatever scheme you want). Most devices ship with 192.168.1.1 as the default, and since we’re going to be double-NATed, we can’t have two identical IPs on the same network. We’ll also set DNS here.\nuci set network.lan.ipaddr='10.70.74.1' uci set network.lan.force_link='1' uci set network.lan.dns='8.8.8.8 1.1.1.1' uci commit network service network restart Login again at the new address (not 192.168.1.1).\nDevices vs interfaces Now we need to clarify some terms. In OpenWrt, a “device” is a Linux kernel network device, like eth0, but also includes virtual devices like the default bridge called br-lan. You can see devices by typing ip link show on the command line (they’re the entries without the @ symbol).\nAn “interface” is a logical configuration associated with a specific device that allows you to define and manage network settings (e.g., IP addresses, subnet masks, security settings…). Confusingly, the devices and interfaces can (and do) sometimes have the same name by default (e.g., the wan interface is bound to the wan device).\nIn terms of wireless, a “radio” is a device (e.g., radio0), but it also has an interface (e.g., default_radio0) where you can setup your wireless networks.\nSetup WANs First, we’re going to create a wireless WAN interface called wwan.\nuci set network.wwan='interface' uci set network.wwan.proto='dhcp' uci set network.wwan.peerdns='0' uci set network.wwan.dns='8.8.8.8 1.1.1.1' uci commit network service network restart Let’s also take this time to set the same DNS on the wired WAN called wan.\nuci set network.wan.peerdns='0' uci set network.wan.dns='8.8.8.8 1.1.1.1' uci commit network service network restart Next, we need to enable both wireless radios and change the country code (adjust as needed).\nuci set wireless.radio0.disabled='0' uci set wireless.radio1.disabled='0' uci set wireless.radio0.country='US' uci set wireless.radio1.country='US' uci commit wireless service network restart This next part is easier to do in the web interface. In LuCI, go to Network, then Wireless. You can see here that the Beryl has two radios (radio0 and radio1) each with an interface broadcasting a WiFi network called OpenWrt. You’ll need to decide which radio will be the WAN and which will be the LAN, but keep in mind that one is 2.4GHz and one is 5GHz.\nI’ve never seen a hotel with great WiFi, so I’m going to make the 2.4GHz radio (radio0) my wireless WAN, and have the 5GHz radio (radio1) as my wireless LAN. This also works for me because all of my devices that will be on the wireless LAN support 5GHz. To set this up, go to radio0 and click on Scan (if you’re using the opposite radio, you’ll need to adjust the rest of this tutorial as needed).\nHere, you’ll see all of the WiFi networks around you. I’m going to pick my home network for the setup, but at the hotel, you’ll do this same process again to select their WiFi.\nMake sure you check the box that says Replace wireless configuration, then enter your network’s WiFi password, click on Submit.\nYou can change the channel info here if you want. Past that, scroll down and make sure the Network is set to wwan (the interface we created earlier), and click on Save.\nBack on the wireless page, click on Save \u0026 Apply.\nAt this point, the Beryl should be online and able to reach the internet. If you can’t reach the internet, make sure you typed the network password correctly.\nping google.com Setup wireless LAN Now we need to setup the WiFi on the wireless LAN. Start by going back to wireless page in LuCI and click on Edit on the WiFi network of radio1.\nYou can change the channel info here if you want. Past that, scroll down, and on the General Setup tab, change the ESSID to whatever you want to broadcast (I’m calling mine OpenWrt_Travel_Router) and make sure the Network is set to lan.\nThen, on the Wireless Security tab, change the Encryption type to whatever you want. I’m going with WPA3-SAE, but if you have legacy devices that don’t support WPA3, you might want to go with WPA2-PSK (or choose one of the mixed modes). Once you’re done, click on Save.\nBack on the wireless page, click on Save \u0026 Apply.\nCheckpoint Congrats, you’re done!\nDisconnect the ethernet cable from the router and connect to the new SSID (mine was called OpenWrt_Travel_Router). You should get an IP in the same range as the wired connection (mine was 10.70.74.x).\nLet’s take stock of where we’re at now. We have a travel router that has three basic interfaces:\nwireless WAN (the radio0 device) wired WAN (the port labeled WAN) a LAN bridge (both LAN ports and radio1) Visually, that looks like this:\nNotes How to use this When you get to the hotel, power on the travel router and connect to the LAN (either wired or wireless) Login to LuCI If the upstream connection is wired, just plug the hotel ethernet into the WAN port on the Beryl If the upstream connection is wireless (more likely), go to radio0 and click on Scan (if you’re using the opposite radio, you’ll need to adjust). From the list of networks, select the hotel’s WiFi. On the next screen, make sure you check the box that says Replace wireless configuration, then enter your hotel’s WiFi password (if there is no password, leave it blank). If the hotel has a captive portal, you just need to visit a page like https://google.com or http://neverssl.com on your client device and you’ll be redirected. There is an OpenWrt package called travelmate that supposedly assists with connection handling, but I never needed it during my travels.\nIf you have issues If you have problems connecting to captive portals and getting internet access, you might want to try disabling DNS rebind protection. This is because the OpenWrt router is behind another router, so DNS responses from the upstream router might contain private IPs (e.g., 10.0.0.0, 172.16.0.0, or 192.168.0.0).\nuci set dhcp.@dnsmasq[0].rebind_protection='0' uci commit dhcp service dnsmasq restart However, I’ve tried to work around this by setting 8.8.8.8 and 1.1.1.1 as upstream DNS servers, so they should return correct IPs, not private IPs.\nA note on VPN access I chose not to install a VPN like WireGuard or Tailscale on the OpenWrt router. I prefer to run VPNs on each client device, but OpenWrt supports WireGuard and Tailscale.\nConclusion In the end, the Beryl with OpenWrt performed beautifully. Neither hotel had a wired ethernet jack (that I could find), so I ended up using the hotel’s WiFi as my upstream, and connected my devices to the Beryl’s WiFi. The speed directly on the hotel WiFI was exactly the same as when running on the Beryl, so the Beryl wasn’t a bottleneck at all. There was one time where I was on the Beryl’s WiFi but didn’t have internet access, so I rebooted the router and it worked fine after that.\n-Logan\n",
  "wordCount" : "2345",
  "inLanguage": "en",
  "image":"https://loganmarchione.github.io/assets/featured/featured_openwrt_new.svg","datePublished": "2024-01-01T00:00:00Z",
  "dateModified": "2024-01-01T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Logan Marchione"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://loganmarchione.github.io/2024/01/beryl-travel-router-with-openwrt/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Logan Marchione",
    "logo": {
      "@type": "ImageObject",
      "url": "https://loganmarchione.github.io/assets/favicon/favicon_loganmarchione_logo.svg"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://loganmarchione.github.io" accesskey="h" title="Logan Marchione (Alt + H)">
                <img src="https://loganmarchione.github.io/assets/favicon/favicon_loganmarchione_logo.svg" alt="" aria-label="logo"
                    height="35">Logan Marchione</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://loganmarchione.github.io/about" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://loganmarchione.github.io/privacy" title="Privacy">
                    <span>Privacy</span>
                </a>
            </li>
            <li>
                <a href="https://loganmarchione.github.io/search" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://loganmarchione.github.io/index.xml" title="RSS">
                    <span>RSS</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Beryl travel router with OpenWrt
    </h1>
    <div class="post-meta"><span title='2024-01-01 00:00:00 +0000 UTC'>2024-01-01</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;2345 words&nbsp;·&nbsp;Logan Marchione

</div>
  </header> 
<figure class="entry-cover"><img loading="lazy" src="https://loganmarchione.github.io/assets/featured/featured_openwrt_new.svg" alt="featured image">
        
</figure><div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="#design" aria-label="Design">Design</a><ul>
                        
                <li>
                    <a href="#network-overview" aria-label="Network overview">Network overview</a></li>
                <li>
                    <a href="#hardware" aria-label="Hardware">Hardware</a></li>
                <li>
                    <a href="#software" aria-label="Software">Software</a></li></ul>
                </li>
                <li>
                    <a href="#setup" aria-label="Setup">Setup</a><ul>
                        
                <li>
                    <a href="#install-openwrt" aria-label="Install OpenWrt">Install OpenWrt</a></li>
                <li>
                    <a href="#configure-openwrt" aria-label="Configure OpenWrt">Configure OpenWrt</a><ul>
                        
                <li>
                    <a href="#initial-login" aria-label="Initial login">Initial login</a></li>
                <li>
                    <a href="#set-a-password" aria-label="Set a password">Set a password</a></li>
                <li>
                    <a href="#set-hostname" aria-label="Set hostname">Set hostname</a></li>
                <li>
                    <a href="#secure-ssh" aria-label="Secure SSH">Secure SSH</a></li>
                <li>
                    <a href="#lan-settings" aria-label="LAN settings">LAN settings</a></li>
                <li>
                    <a href="#devices-vs-interfaces" aria-label="Devices vs interfaces">Devices vs interfaces</a></li>
                <li>
                    <a href="#setup-wans" aria-label="Setup WANs">Setup WANs</a></li>
                <li>
                    <a href="#setup-wireless-lan" aria-label="Setup wireless LAN">Setup wireless LAN</a></li></ul>
                </li>
                <li>
                    <a href="#checkpoint" aria-label="Checkpoint">Checkpoint</a></li></ul>
                </li>
                <li>
                    <a href="#notes" aria-label="Notes">Notes</a><ul>
                        
                <li>
                    <a href="#how-to-use-this" aria-label="How to use this">How to use this</a></li>
                <li>
                    <a href="#if-you-have-issues" aria-label="If you have issues">If you have issues</a></li>
                <li>
                    <a href="#a-note-on-vpn-access" aria-label="A note on VPN access">A note on VPN access</a></li></ul>
                </li>
                <li>
                    <a href="#conclusion" aria-label="Conclusion">Conclusion</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><p>Hey! Listen! This post is part of a series on using OpenWrt. Check them all out!</p>
<table>
<thead>
<tr>
<th>Date</th>
<th>URL</th>
<th>Part</th>
</tr>
</thead>
<tbody>
<tr>
<td>2024-01-31</td>
<td><a href="/2024/01/beryl-travel-router-with-openwrt/">Beryl travel router with OpenWrt</a></td>
<td>OpenWrt revisited</td>
</tr>
<tr>
<td>2016-04-28</td>
<td><a href="/2016/04/openwrt-upgrade-process/">OpenWrt upgrade process</a></td>
<td>OpenWrt upgrade</td>
</tr>
<tr>
<td>2015-08-26</td>
<td><a href="/2015/08/openwrt-with-openvpn-server-on-tp-link-archer-c7/">OpenWrt with OpenVPN server on TP-Link Archer C7</a></td>
<td>Initial post</td>
</tr>
<tr>
<td>2015-02-15</td>
<td><a href="/2015/02/openwrt-with-openvpn-client-on-tp-link-tl-mr3020-3/">OpenWrt with OpenVPN client on TP-Link TL-MR3020</a></td>
<td>Initial post</td>
</tr>
</tbody>
</table>
<h1 id="introduction">Introduction<a hidden class="anchor" aria-hidden="true" href="#introduction">#</a></h1>
<p>It&rsquo;s been over seven years since I last touched OpenWrt. &#x1f92f;</p>
<p>I&rsquo;ve been on a couple trips in the last month and needed a way to share a single internet connection with multiple devices (e.g., Steam Deck, laptops, phones, etc&hellip;). I thought it would be fun to setup OpenWrt on a travel router and to revisit OpenWrt to see what&rsquo;s changed.</p>
<h1 id="design">Design<a hidden class="anchor" aria-hidden="true" href="#design">#</a></h1>
<h2 id="network-overview">Network overview<a hidden class="anchor" aria-hidden="true" href="#network-overview">#</a></h2>
<p>The idea here was to connect one device to my hotel&rsquo;s WiFi, and then connect all of my other devices to that device. In this case, I put my own OpenWrt router behind the hotel&rsquo;s router.</p>
<p>This device is a proper router/firewall and would be useful for a situation where you either need to share a single internet connection with multiple devices, or where you don&rsquo;t trust the upstream connection:</p>
<ul>
<li>paying for in-flight WiFi and <a href="https://austinsnerdythings.com/2023/04/17/how-a-travel-router-can-save-you-money-and-share-wi-fi-on-flights/">sharing it with your other devices</a> (although, I&rsquo;m sure this is against some terms of service)</li>
<li>a dorm/apartment/hotel where a shared network is provided by building management and you don&rsquo;t 100% trust it</li>
<li>physical network segmentation (as opposed to VLANs)</li>
</ul>
<p>My desired setup was below.</p>

<p><img src="/2024/01/beryl-travel-router-with-openwrt/20240108_001.png" loading="lazy" alt="network overview"></p>
<h2 id="hardware">Hardware<a hidden class="anchor" aria-hidden="true" href="#hardware">#</a></h2>
<p>The trick with OpenWrt is not to get hardware that is too old (because it will have bad specs and be slow), but also not get something that is too new (because it won&rsquo;t be supported yet).</p>
<p>I was looking for something that had the following features:</p>
<ul>
<li>physically small (it&rsquo;s for travel, after all)</li>
<li><a href="https://openwrt.org/toh/recommended_routers">good OpenWrt support</a> (preferably with stable support, not snapshot images)</li>
<li>dual-core CPU</li>
<li>at least 128MB of RAM</li>
<li>at least 16MB of flash storage (so I&rsquo;m not having to expand storage onto an <a href="https://openwrt.org/docs/guide-user/additional-software/extroot_configuration">extroot</a> like I <a href="https://loganmarchione.com/2015/02/openwrt-with-openvpn-client-on-tp-link-tl-mr3020/#configure-extroot">used to do</a>)</li>
<li>at least two ethernet ports (WAN and LAN)</li>
<li>at least two radios (WAN and LAN)</li>
<li>preferably had USB-C power input</li>
<li>preferably had 802.11ac (WiFi 5)</li>
</ul>
<p>It just so happened that <a href="https://www.gl-inet.com/">GL.iNet</a> makes a bunch of full-size and travel routers that all run a custom version of OpenWrt. This was a great starting place, and I started looking at the OpenWrt <a href="https://openwrt.org/toh/start">Table of Hardware</a> (ToH). The GL.iNet hardware was perfectly suited to my use case, so it was just a matter of picking a model that had the specs I wanted and was easily available. I ended up choosing the <a href="https://www.gl-inet.com/products/gl-mt1300/">Beryl (GL-MT1300)</a>.</p>
<figure>
    <img loading="lazy" src="20231121_001.jpg"
         alt="beryl (GL-MT1300)" width="100%"/> <figcaption>
            <p>
                    <a href="https://www.gl-inet.com/products/gl-mt1300/">Image from GL.iNet</a></p>
        </figcaption>
</figure>

<figure>
    <img loading="lazy" src="20231121_002.jpg"
         alt="beryl (GL-MT1300)" width="100%"/> <figcaption>
            <p>
                    <a href="https://www.gl-inet.com/products/gl-mt1300/">Image from GL.iNet</a></p>
        </figcaption>
</figure>

<figure>
    <img loading="lazy" src="20231121_003.jpg"
         alt="beryl (GL-MT1300)" width="100%"/> <figcaption>
            <p>
                    <a href="https://www.gl-inet.com/products/gl-mt1300/">Image from GL.iNet</a></p>
        </figcaption>
</figure>

<figure>
    <img loading="lazy" src="20231121_004.jpg"
         alt="beryl (GL-MT1300)" width="100%"/> <figcaption>
            <p>
                    <a href="https://www.gl-inet.com/products/gl-mt1300/">Image from GL.iNet</a></p>
        </figcaption>
</figure>

<figure>
    <img loading="lazy" src="20231121_005.jpg"
         alt="beryl (GL-MT1300)" width="100%"/> <figcaption>
            <p>
                    <a href="https://www.gl-inet.com/products/gl-mt1300/">Image from GL.iNet</a></p>
        </figcaption>
</figure>

<p>I also considered these models:</p>
<ul>
<li><a href="https://mikrotik.com/product/RBmAP2nD">MikroTik mAP</a></li>
<li><a href="https://www.raspberrypi.com/products/raspberry-pi-4-model-b/">Raspberry Pi 4</a> (like <a href="https://www.youtube.com/watch?v=jlHWnKVpygw">NetworkChuck</a> used)</li>
<li><a href="https://www.tp-link.com/us/home-networking/wifi-router/tl-wr902ac/">TP-Link TL-WR902AC</a> (this appears to be an upgraded version of the TL-MR3020 that I used to have)</li>
<li>One of the various <a href="https://www.friendlyelec.com/index.php?route=product/category&amp;path=69">FriendlyElec NanoPi boards</a></li>
<li>the newer <a href="https://www.gl-inet.com/products/gl-mt3000/">Beryl AX (GL-MT3000)</a> (isn&rsquo;t yet supported by OpenWrt)</li>
<li>the <a href="https://www.gl-inet.com/products/gl-a1300/">Slate Plus (GL-A1300)</a></li>
</ul>
<h2 id="software">Software<a hidden class="anchor" aria-hidden="true" href="#software">#</a></h2>
<p>GL.iNet&rsquo;s routers all run a custom version of OpenWrt. I&rsquo;m unsure if the core OpenWrt code is stock, but at the very least, they run a proprietary (i.e., closed-source) UI on top of OpenWrt (although they do still let you <a href="https://docs.gl-inet.com/router/en/4/faq/what_is_luci/">access LuCI</a>). Their UI looks great and exposes a <a href="https://docs.gl-inet.com/router/en/3/setup/gl-mt1300/first_time_setup/">bunch of one-click options</a> that simplify setup.</p>
<ul>
<li>OpenVPN client/server</li>
<li>WireGuard client/server</li>
<li>Repeater</li>
<li>3G/4G modem</li>
<li>Tethering</li>
<li>Captive portal</li>
<li>Dynamic DNS (DDNS)</li>
<li>Hardware button settings</li>
</ul>
<p>This is the <code>3.x</code> version of the UI.</p>

<p><img src="/2024/01/beryl-travel-router-with-openwrt/20231121_006_hudb40c1b278f72f8ec71f2cef92117e0c_216253_800x0_resize_catmullrom_3.png" loading="lazy" alt="gl.inet default user interface"></p>
<p>This is the <code>4.x</code> version of the UI.</p>

<p><img src="/2024/01/beryl-travel-router-with-openwrt/20231121_007_hu86dba87c8020f787ec1fb5e97c064783_175240_800x0_resize_catmullrom_3.png" loading="lazy" alt="gl.inet default user interface"></p>
<p>Unfortunately, this is the part where I mention that GL.iNet is a Chinese company, if that kind of thing bothers you. Regardless of that, I&rsquo;d never run anything proprietary for something that&rsquo;s controlling access to my network, so my plan was always to immediately replace GL.iNet&rsquo;s version of OpenWrt with the stock version.</p>
<h1 id="setup">Setup<a hidden class="anchor" aria-hidden="true" href="#setup">#</a></h1>
<h2 id="install-openwrt">Install OpenWrt<a hidden class="anchor" aria-hidden="true" href="#install-openwrt">#</a></h2>
<p>OpenWrt has two kinds of installations:</p>
<ul>
<li>installing from vendor firmware (called a <a href="https://openwrt.org/docs/guide-quick-start/factory_installation">factory installation</a>)</li>
<li>upgrading OpenWrt (called a <a href="https://openwrt.org/docs/guide-quick-start/sysupgrade.luci">sysupgrade</a>)</li>
</ul>
<p>Because the Beryl already ran a version of OpenWrt from GL.iNet, I needed to do a sysupgrade. The installation process was pretty simple, and I&rsquo;ve summarized the steps from the <a href="https://openwrt.org/toh/gl.inet/gl-mt1300_v1">wiki page for the Beryl</a>:</p>
<ol>
<li>On my laptop, I went to the <a href="https://firmware-selector.openwrt.org/">OpenWrt Firmware Selector</a> (this was much easier than navigating the <a href="https://downloads.openwrt.org/releases/">firmware directories</a>), found my <a href="https://firmware-selector.openwrt.org/?version=23.05.2&amp;target=ramips%2Fmt7621&amp;id=glinet_gl-mt1300">model</a>, downloaded the <code>sysupgrade</code> file, and verified the <code>sha256</code> hash of the file</li>
<li>Connected to the Beryl&rsquo;s LAN port (which after booting, gave me an IP in the <code>192.168.8.x</code> range)</li>
<li>Browsed to <a href="http://192.168.8.1/">http://192.168.8.1/</a>, went through the setup wizard, then browsed to <a href="http://192.168.8.1/#/upgrade">http://192.168.8.1/#/upgrade</a> and uploaded the <code>sysupgrade</code> file</li>
<li>Hit an error that read <code> failed! ERROR: Incorrect firmware format!</code></li>
<li>Upgraded the factory firmware from <code>3.211</code> to <code>3.216</code> to <code>4.3.7</code> from <a href="https://dl.gl-inet.com/?model=mt1300">this page</a></li>
<li>Repeated step 3, waited 5 mins, and rebooted into OpenWrt at <a href="https://192.168.1.1/">https://192.168.1.1/</a>!</li>
</ol>
<h2 id="configure-openwrt">Configure OpenWrt<a hidden class="anchor" aria-hidden="true" href="#configure-openwrt">#</a></h2>
<p>OpenWrt has a really great configuration system. It stores its configuration files in <code>/etc/config</code> in a system known as the <a href="https://openwrt.org/docs/guide-user/base-system/uci">Unified Configuration Interface</a> (UCI). The UCI is basically a collection of easy-to-read configuration files that are all centrally located, making OpenWrt much easier to configure. You can edit these files manually with <code>vi</code> or <code>nano</code>, but there is also a <a href="https://openwrt.org/docs/guide-user/base-system/uci">command line tool</a> called <code>uci</code> that you can use to edit the files (great for scripting).</p>
<p>The web interface for OpenWrt is called <a href="https://openwrt.org/docs/guide-user/luci/start">LuCI</a> (I&rsquo;m guessing it&rsquo;s short for Lua UCI, because it&rsquo;s written in Lua).   What&rsquo;s nice about LuCI is that it reads/writes from/to the UCI files. Any changes you make in LuCI are reflected in the UCI files, and vice versa, meaning you can configure OpenWrt from the web interface, or from the command line.</p>
<h3 id="initial-login">Initial login<a hidden class="anchor" aria-hidden="true" href="#initial-login">#</a></h3>
<p>Navigate to <a href="https://192.168.1.1/">https://192.168.1.1/</a> in your browser and you&rsquo;ll be greeted by an SSL error. This is because the web interface uses a <a href="https://openwrt.org/docs/guide-user/luci/luci.secure">self-signed certificate</a> out of the box. It&rsquo;s safe to click through this, since your traffic is encrypted and you know the certificate is from the router (or you can browse to <a href="http://192.168.1.1/">http://192.168.1.1/</a> without HTTPS).</p>
<p>Moving on. Leave the username as &ldquo;root&rdquo; and the password field empty.</p>

<p><img src="/2024/01/beryl-travel-router-with-openwrt/20231121_008.png" loading="lazy" alt="openwrt login page"></p>
<p>Click on <em>Login</em> to continue and you&rsquo;ll see the status page.</p>

<p><img src="/2024/01/beryl-travel-router-with-openwrt/20231121_009.png" loading="lazy" alt="openwrt status page"></p>
<h3 id="set-a-password">Set a password<a hidden class="anchor" aria-hidden="true" href="#set-a-password">#</a></h3>
<p>From the main status page, we&rsquo;re going to set a root password by using the link in the yellow box at the top of the page. Here, you can (and should) set a root password. Click on <em>Save</em> to continue.</p>

<p><img src="/2024/01/beryl-travel-router-with-openwrt/20231121_010.png" loading="lazy" alt="openwrt password change page"></p>
<p>You can now SSH into the router with those credentials.</p>
<pre tabindex="0"><code>&gt; ssh root@192.168.1.1 
root@192.168.1.1&#39;s password: 


BusyBox v1.36.1 (2023-11-14 13:38:11 UTC) built-in shell (ash)

  _______                     ________        __
 |       |.-----.-----.-----.|  |  |  |.----.|  |_
 |   -   ||  _  |  -__|     ||  |  |  ||   _||   _|
 |_______||   __|_____|__|__||________||__|  |____|
          |__| W I R E L E S S   F R E E D O M
 -----------------------------------------------------
 OpenWrt 23.05.2, r23630-842932a63d
 -----------------------------------------------------
root@OpenWrt:~#
</code></pre><h3 id="set-hostname">Set hostname<a hidden class="anchor" aria-hidden="true" href="#set-hostname">#</a></h3>
<p>First, set a hostname for the device and reboot.</p>
<pre tabindex="0"><code>uci set system.@system[0].hostname=&#39;OpenWrt_TR&#39;
uci commit system
reboot
</code></pre><h3 id="secure-ssh">Secure SSH<a hidden class="anchor" aria-hidden="true" href="#secure-ssh">#</a></h3>
<p>SSH is listening on all interfaces (LAN and WAN). I like to only be able to SSH via the LAN interface. Use the commands below to change that.</p>
<pre tabindex="0"><code>uci set dropbear.@dropbear[0].Interface=&#39;lan&#39;
uci commit dropbear
service dropbear restart
</code></pre><h3 id="lan-settings">LAN settings<a hidden class="anchor" aria-hidden="true" href="#lan-settings">#</a></h3>
<p>Next, we&rsquo;re going to change the default IP of the router from <code>192.168.1.1</code> to <code>10.70.74.1</code> (or whatever scheme you want). Most devices ship with <code>192.168.1.1</code> as the default, and since we&rsquo;re going to be double-NATed, we can&rsquo;t have two identical IPs on the same network. We&rsquo;ll also set DNS here.</p>
<pre tabindex="0"><code>uci set network.lan.ipaddr=&#39;10.70.74.1&#39;
uci set network.lan.force_link=&#39;1&#39;
uci set network.lan.dns=&#39;8.8.8.8 1.1.1.1&#39;
uci commit network
service network restart
</code></pre><p>Login again at the new address (not <code>192.168.1.1</code>).</p>
<h3 id="devices-vs-interfaces">Devices vs interfaces<a hidden class="anchor" aria-hidden="true" href="#devices-vs-interfaces">#</a></h3>
<p>Now we need to clarify some terms. In OpenWrt, a &ldquo;device&rdquo; is a Linux kernel network device, like <code>eth0</code>, but also includes virtual devices like the default bridge called <code>br-lan</code>. You can see devices by typing <code>ip link show</code> on the command line (they&rsquo;re the entries without the <code>@</code> symbol).</p>
<p>An &ldquo;interface&rdquo; is a logical configuration associated with a specific device that allows you to define and manage network settings (e.g., IP addresses, subnet masks, security settings&hellip;). Confusingly, the devices and interfaces can (and do) sometimes have the same name by default (e.g., the <code>wan</code> interface is bound to the <code>wan</code> device).</p>
<p>In terms of wireless, a &ldquo;radio&rdquo; is a device (e.g., <code>radio0</code>), but it also has an interface (e.g., <code>default_radio0</code>) where you can setup your wireless networks.</p>
<h3 id="setup-wans">Setup WANs<a hidden class="anchor" aria-hidden="true" href="#setup-wans">#</a></h3>
<p>First, we&rsquo;re going to create a wireless WAN interface called <code>wwan</code>.</p>
<pre tabindex="0"><code>uci set network.wwan=&#39;interface&#39;
uci set network.wwan.proto=&#39;dhcp&#39;
uci set network.wwan.peerdns=&#39;0&#39;
uci set network.wwan.dns=&#39;8.8.8.8 1.1.1.1&#39;
uci commit network
service network restart
</code></pre><p>Let&rsquo;s also take this time to set the same DNS on the wired WAN called <code>wan</code>.</p>
<pre tabindex="0"><code>uci set network.wan.peerdns=&#39;0&#39;
uci set network.wan.dns=&#39;8.8.8.8 1.1.1.1&#39;
uci commit network
service network restart
</code></pre><p>Next, we need to enable both wireless radios and change the country code (adjust as needed).</p>
<pre tabindex="0"><code>uci set wireless.radio0.disabled=&#39;0&#39;
uci set wireless.radio1.disabled=&#39;0&#39;
uci set wireless.radio0.country=&#39;US&#39;
uci set wireless.radio1.country=&#39;US&#39;
uci commit wireless
service network restart
</code></pre><p>This next part is easier to do in the web interface. In LuCI, go to <em>Network</em>, then <em>Wireless</em>. You can see here that the Beryl has two radios (<code>radio0</code> and <code>radio1</code>) each with an interface broadcasting a WiFi network called <code>OpenWrt</code>. You&rsquo;ll need to decide which radio will be the WAN and which will be the LAN, but keep in mind that one is 2.4GHz and one is 5GHz.</p>

<p><img src="/2024/01/beryl-travel-router-with-openwrt/20231121_011.png" loading="lazy" alt="openwrt wireless page"></p>
<p>I&rsquo;ve never seen a hotel with great WiFi, so I&rsquo;m going to make the 2.4GHz radio (<code>radio0</code>) my wireless WAN, and have the 5GHz radio (<code>radio1</code>) as my wireless LAN. This also works for me because all of my devices that will be on the wireless LAN support 5GHz. To set this up, go to <code>radio0</code> and click on <em>Scan</em> (if you&rsquo;re using the opposite radio, you&rsquo;ll need to adjust the rest of this tutorial as needed).</p>

<p><img src="/2024/01/beryl-travel-router-with-openwrt/20231121_012.png" loading="lazy" alt="openwrt wireless page"></p>
<p>Here, you&rsquo;ll see all of the WiFi networks around you. I&rsquo;m going to pick my home network for the setup, but at the hotel, <strong>you&rsquo;ll do this same process again to select their WiFi</strong>.</p>

<p><img src="/2024/01/beryl-travel-router-with-openwrt/20231121_013.png" loading="lazy" alt="selecting a wifi network"></p>
<p>Make sure you check the box that says <em>Replace wireless configuration</em>, then enter your network&rsquo;s WiFi password, click on <em>Submit</em>.</p>

<p><img src="/2024/01/beryl-travel-router-with-openwrt/20231121_014.png" loading="lazy" alt="joining a wifi network"></p>
<p>You can change the channel info here if you want. Past that, scroll down and make sure the <em>Network</em> is set to <code>wwan</code> (the interface we created earlier), and click on <em>Save</em>.</p>

<p><img src="/2024/01/beryl-travel-router-with-openwrt/20231121_015.png" loading="lazy" alt="wifi network settings"></p>
<p>Back on the wireless page, click on <em>Save &amp; Apply</em>.</p>

<p><img src="/2024/01/beryl-travel-router-with-openwrt/20231121_016.png" loading="lazy" alt="openwrt wireless page"></p>
<p>At this point, the Beryl should be online and able to reach the internet. If you can&rsquo;t reach the internet, make sure you typed the network password correctly.</p>
<pre tabindex="0"><code>ping google.com
</code></pre><h3 id="setup-wireless-lan">Setup wireless LAN<a hidden class="anchor" aria-hidden="true" href="#setup-wireless-lan">#</a></h3>
<p>Now we need to setup the WiFi on the wireless LAN. Start by going back to wireless page in LuCI and click on <em>Edit</em> on the WiFi network of <code>radio1</code>.</p>

<p><img src="/2024/01/beryl-travel-router-with-openwrt/20231121_017.png" loading="lazy" alt="openwrt wireless page"></p>
<p>You can change the channel info here if you want. Past that, scroll down, and on the <em>General Setup</em> tab, change the <em>ESSID</em> to whatever you want to broadcast (I&rsquo;m calling mine <code>OpenWrt_Travel_Router</code>) and make sure the <em>Network</em> is set to <code>lan</code>.</p>

<p><img src="/2024/01/beryl-travel-router-with-openwrt/20231121_018.png" loading="lazy" alt="wifi network settings"></p>
<p>Then, on the <em>Wireless Security</em> tab, change the <em>Encryption</em> type to whatever you want. I&rsquo;m going with <code>WPA3-SAE</code>, but if you have legacy devices that don&rsquo;t support WPA3, you might want to go with <code>WPA2-PSK</code> (or choose one of the <code>mixed</code> modes). Once you&rsquo;re done, click on <em>Save</em>.</p>

<p><img src="/2024/01/beryl-travel-router-with-openwrt/20231121_019.png" loading="lazy" alt="wifi network settings"></p>
<p>Back on the wireless page, click on <em>Save &amp; Apply</em>.</p>

<p><img src="/2024/01/beryl-travel-router-with-openwrt/20231121_020.png" loading="lazy" alt="openwrt wireless page"></p>
<h2 id="checkpoint">Checkpoint<a hidden class="anchor" aria-hidden="true" href="#checkpoint">#</a></h2>
<p>Congrats, you&rsquo;re done!</p>
<p>Disconnect the ethernet cable from the router and connect to the new SSID (mine was called <code>OpenWrt_Travel_Router</code>). You should get an IP in the same range as the wired connection (mine was <code>10.70.74.x</code>).</p>
<p>Let&rsquo;s take stock of where we&rsquo;re at now. We have a travel router that has three basic interfaces:</p>
<ul>
<li>wireless WAN (the <code>radio0</code> device)</li>
<li>wired WAN (the port labeled WAN)</li>
<li>a LAN bridge (both LAN ports and <code>radio1</code>)</li>
</ul>
<p>Visually, that looks like this:</p>

<p><img src="/2024/01/beryl-travel-router-with-openwrt/20231121_021.jpg" loading="lazy" alt="topology"></p>
<h1 id="notes">Notes<a hidden class="anchor" aria-hidden="true" href="#notes">#</a></h1>
<h2 id="how-to-use-this">How to use this<a hidden class="anchor" aria-hidden="true" href="#how-to-use-this">#</a></h2>
<ol>
<li>When you get to the hotel, power on the travel router and connect to the LAN (either wired or wireless)</li>
<li>Login to LuCI</li>
<li>If the upstream connection is wired, just plug the hotel ethernet into the WAN port on the Beryl</li>
<li>If the upstream connection is wireless (more likely), go to <code>radio0</code> and click on <em>Scan</em> (if you&rsquo;re using the opposite radio, you&rsquo;ll need to adjust). From the list of networks, select the hotel&rsquo;s WiFi. On the next screen, make sure you check the box that says <em>Replace wireless configuration</em>, then enter your hotel&rsquo;s WiFi password (if there is no password, leave it blank).</li>
<li>If the hotel has a captive portal, you just need to visit a page like <a href="https://google.com">https://google.com</a> or <a href="http://neverssl.com">http://neverssl.com</a> on your client device and you&rsquo;ll be redirected.</li>
</ol>
<p>There is an OpenWrt package called <a href="https://github.com/openwrt/packages/blob/master/net/travelmate/files/README.md">travelmate</a> that supposedly assists with connection handling, but I never needed it during my travels.</p>
<h2 id="if-you-have-issues">If you have issues<a hidden class="anchor" aria-hidden="true" href="#if-you-have-issues">#</a></h2>
<p>If you have problems connecting to captive portals and getting internet access, you might want to try disabling DNS rebind protection. This is because the OpenWrt router is behind another router, so DNS responses from the upstream router might contain <a href="https://datatracker.ietf.org/doc/html/rfc1918">private IPs</a> (e.g., <code>10.0.0.0</code>, <code>172.16.0.0</code>, or <code>192.168.0.0</code>).</p>
<pre tabindex="0"><code>uci set dhcp.@dnsmasq[0].rebind_protection=&#39;0&#39;
uci commit dhcp
service dnsmasq restart
</code></pre><p>However, I&rsquo;ve tried to work around this by setting <code>8.8.8.8</code> and <code>1.1.1.1</code> as upstream DNS servers, so they should return correct IPs, not private IPs.</p>
<h2 id="a-note-on-vpn-access">A note on VPN access<a hidden class="anchor" aria-hidden="true" href="#a-note-on-vpn-access">#</a></h2>
<p>I chose <strong>not</strong> to install a VPN like WireGuard or Tailscale on the OpenWrt router. I prefer to run VPNs on each client device, but OpenWrt supports <a href="https://openwrt.org/docs/guide-user/services/vpn/wireguard/client">WireGuard</a> and <a href="https://openwrt.org/docs/guide-user/services/vpn/tailscale/start">Tailscale</a>.</p>
<h1 id="conclusion">Conclusion<a hidden class="anchor" aria-hidden="true" href="#conclusion">#</a></h1>
<p>In the end, the Beryl with OpenWrt performed beautifully. Neither hotel had a wired ethernet jack (that I could find), so I ended up using the hotel&rsquo;s WiFi as my upstream, and connected my devices to the Beryl&rsquo;s WiFi. The speed directly on the hotel WiFI was exactly the same as when running on the Beryl, so the Beryl wasn&rsquo;t a bottleneck at all. There was one time where I was on the Beryl&rsquo;s WiFi but didn&rsquo;t have internet access, so I rebooted the router and it worked fine after that.</p>
<p>-Logan</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>

<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share Beryl travel router with OpenWrt on twitter"
        href="https://twitter.com/intent/tweet/?text=Beryl%20travel%20router%20with%20OpenWrt&amp;url=https%3a%2f%2floganmarchione.github.io%2f2024%2f01%2fberyl-travel-router-with-openwrt%2f&amp;hashtags=">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Beryl travel router with OpenWrt on linkedin"
        href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2floganmarchione.github.io%2f2024%2f01%2fberyl-travel-router-with-openwrt%2f&amp;title=Beryl%20travel%20router%20with%20OpenWrt&amp;summary=Beryl%20travel%20router%20with%20OpenWrt&amp;source=https%3a%2f%2floganmarchione.github.io%2f2024%2f01%2fberyl-travel-router-with-openwrt%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Beryl travel router with OpenWrt on reddit"
        href="https://reddit.com/submit?url=https%3a%2f%2floganmarchione.github.io%2f2024%2f01%2fberyl-travel-router-with-openwrt%2f&title=Beryl%20travel%20router%20with%20OpenWrt">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Beryl travel router with OpenWrt on facebook"
        href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2floganmarchione.github.io%2f2024%2f01%2fberyl-travel-router-with-openwrt%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Beryl travel router with OpenWrt on whatsapp"
        href="https://api.whatsapp.com/send?text=Beryl%20travel%20router%20with%20OpenWrt%20-%20https%3a%2f%2floganmarchione.github.io%2f2024%2f01%2fberyl-travel-router-with-openwrt%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
            <path
                d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Beryl travel router with OpenWrt on telegram"
        href="https://telegram.me/share/url?text=Beryl%20travel%20router%20with%20OpenWrt&amp;url=https%3a%2f%2floganmarchione.github.io%2f2024%2f01%2fberyl-travel-router-with-openwrt%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
            <path
                d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share Beryl travel router with OpenWrt on ycombinator"
        href="https://news.ycombinator.com/submitlink?t=Beryl%20travel%20router%20with%20OpenWrt&u=https%3a%2f%2floganmarchione.github.io%2f2024%2f01%2fberyl-travel-router-with-openwrt%2f">
        <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
            xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
            <path
                d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
        </svg>
    </a>
</div>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://loganmarchione.github.io">Logan Marchione</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><div class="kb-club">
  <a target="_blank" href="https://512kb.club"><img src="/assets/assets/512kb-club-green-team.svg" alt="512kb club badge"></a>
</div>


<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
